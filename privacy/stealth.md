# 隐形地址

隐形地址的目的是在公开环境中隐藏交易的接收方信息。常用的做法是使用密钥交换协议创建临时的地址，仅有持有对应私钥的接收方可以验证该地址，从而接收交易。

下面以椭圆曲线密钥交换协议（ECDH）为例说明隐形地址的构造原理。

## ECDH

定义在素数域Fp上的椭圆曲线C(Fp)，其基点为G。

Alice的私钥a，以及公钥A=a·G。
Bob的私钥b，以及公钥B=b·G。

Alice计算K=a·B，使用K；Bob计算K'=b·A。

有K=a·B=ab·G=ba·G=b·A=K'。

K即可作为Alice和Bob的共享密钥。


## 利用ECDH原理构造隐形地址

Bob向Alice发起一笔交易，需要执行以下操作：
1. 选取一个随机数r，并计算R=r·G
2. 计算S=rA
3. 计算e=H(S)，H为一种从C(Fp)到Fp的Hash函数
4. 计算E=e·G
5. 使用E作为接收方地址构造交易，并在交易中附加R

Alice收到交易后，进行如下验证：
1. 取出R，计算S'=a·R=ar·G=ra·G=r·A=S
2. 计算e'=H(S')
3. 计算E'=e'·G，与交易接收地址E对比。
只有使用Alice的私钥a可以正确计算出E'=E，从而可使用e'作为私钥发起下一笔交易。


## 算法的变种

考虑进一步增强Alice的私钥安全性，可以使用辅助密钥对A'=a'·G。

构造交易地址的方式为
E=H(r·A')·G+A

验证地址的方式为
E'=H(a'R)·G+A

这种情况下，Alice的私钥a可以与交易验证环境分离。

这种变式也可以用来进行账户权限的划分。如密钥对(A,a)用来发起交易，
密钥对(A',a')用来验证并查看交易信息。
这样，Alice可以将a'授权给他人，使之有权查看其相关的交易。
